<section class="container my-4">
  <div class="position-relative mb-3">
    <h4 class="mb-0 text-center">All Products</h4>
    <a href="/all-products"
      class="position-absolute top-50 end-0 translate-middle-y text-decoration-none text-black small">
      View All
    </a>
  </div>

  {% set products = frappe.db.sql("""
  SELECT
  wi.item_name,
  wi.item_code,
  wi.route,
  wi.website_image AS image,
  (
  SELECT ip.price_list_rate
  FROM `tabItem Price` ip
  WHERE ip.item_code = wi.item_code
  LIMIT 1
  ) AS price
  FROM `tabWebsite Item` wi
  WHERE wi.published = 1
  """, as_dict=True) %}

  <!-- Wrapper -->
  <div class="product-wrapper">

    <!-- Left Arrow -->
    <button class="product-btn prev">‹</button>

    <!-- Scroll Container -->
    <div class="product-scroll">

      {% for product in products %}
      <div class="product-card">

        <div class="card h-100 border rounded-4 shadow-sm position-relative p-3">

          <a href="/{{ product.route }}" class="text-decoration-none text-dark">

            <div class="fw-semibold text-center mb-1">
              {{ product.item_name }}
            </div>

            <!-- Rating -->
            <div class="d-flex justify-content-center gap-1 mb-2">
              <i class="bi bi-star-fill text-warning"></i>
              <i class="bi bi-star-fill text-warning"></i>
              <i class="bi bi-star-fill text-warning"></i>
              <i class="bi bi-star-fill text-warning"></i>
              <i class="bi bi-star text-warning"></i>
              <small class="text-muted ms-1">(7)</small>
            </div>

            <!-- Image -->
            <div class="d-flex justify-content-center mb-3">
              <img src="{{ product.image }}" class="img-fluid product-img" alt="{{ product.item_name }}">
            </div>

            <!-- Price -->
            {% if product.price %}
            <p class="fw-bold text-center mb-1">₹ {{ product.price }}</p>
            {% else %}
            <p class="text-muted text-center mb-1">Price Not Available</p>
            {% endif %}

            <p class="text-muted text-center small mb-0">
              93 Purchases
            </p>

          </a>

          <!-- Wishlist -->
          <!-- <button class="btn btn-link p-0 heart-btn" onclick="event.preventDefault(); addToWishlist('{{ product.item_code }}','{{ product.item_name }}');">
            <i class="bi bi-heart text-danger fs-5"></i>
          </button> -->

        </div>

      </div>
      {% endfor %}

    </div>

    <!-- Right Arrow -->
    <button class="product-btn next">›</button>

  </div>
</section>

<style>
  .heart-btn i:hover {
    color: #dc3545;
  }

  .heart-btn:hover i {
    font-weight: bold;
  }

  .product-wrapper {
    position: relative;
    display: flex;
    align-items: center;
  }

  .product-scroll {
    display: flex;
    gap: 16px;
    overflow-x: hidden;
    padding: 10px 50px;
    scroll-behavior: smooth;
  }

  .product-card {
    flex: 0 0 auto;
    width: 260px;
  }

  .product-img {
    max-height: 180px;
    object-fit: contain;
  }

  .heart-btn {
    position: absolute;
    bottom: 12px;
    right: 12px;
  }

  /* Arrow buttons */
  .product-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.15);
    color: #fff;
    border: none;
    width: 42px;
    height: 42px;
    border-radius: 50%;
    font-size: 26px;
    cursor: pointer;
    z-index: 5;
  }

  .product-btn.prev {
    left: 0;
  }

  .product-btn.next {
    right: 0;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {

    const container = document.querySelector(".product-scroll");
    const prevBtn = document.querySelector(".product-btn.prev");
    const nextBtn = document.querySelector(".product-btn.next");

    const CARD_WIDTH = 276; // card width + gap
    let autoScrollInterval;
    let isPaused = false;

    function startAutoScroll() {
      stopAutoScroll();
      autoScrollInterval = setInterval(() => {
        if (!isPaused) {
          container.scrollLeft += CARD_WIDTH;

          if (
            container.scrollLeft + container.clientWidth >=
            container.scrollWidth
          ) {
            container.scrollLeft = 0;
          }
        }
      }, 3000);
    }

    function stopAutoScroll() {
      clearInterval(autoScrollInterval);
    }

    startAutoScroll();

    function pauseAndResume() {
      isPaused = true;
      setTimeout(() => isPaused = false, 3000);
    }

    nextBtn.addEventListener("click", () => {
      container.scrollBy({ left: CARD_WIDTH, behavior: "smooth" });
      pauseAndResume();
    });

    prevBtn.addEventListener("click", () => {
      container.scrollBy({ left: -CARD_WIDTH, behavior: "smooth" });
      pauseAndResume();
    });

  });
</script>