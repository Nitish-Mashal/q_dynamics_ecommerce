{% extends "templates/web.html" %}
{% block page_content %}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

<style>
    .primary-bg {
        background: #00a79d !important;
    }

    .primary-text {
        color: #00a79d;
    }

    .rounded-4 {
        border-radius: 1.5rem;
    }

    .btn.primary-bg:hover,
    .btn.primary-bg:focus,
    .btn.primary-bg:active {
        background: #00a79d !important;
        color: #fff !important;
        box-shadow: none !important;
    }
</style>

<!-- BANNER -->
<div class="w-100" style="height:280px;background:url('/files/contact-us.jpg') center/cover;"></div>

<div class="container py-3">

    <div class="d-flex justify-content-center">
        <div class="card shadow-lg rounded-4 w-100" style="max-width:1200px;">
            <div class="row g-0">

                <!-- FORM -->
                <div class="col-md-8 p-4">
                    <div style="max-width:420px;">
                        <h3 class="fw-bold primary-text">Get in Touch</h3>
                        <p class="text-muted small">Have questions? We’d love to hear from you.</p>

                        <form id="contactForm">

                            <div class="mb-2">
                                <label class="form-label primary-text">Name *</label>
                                <input type="text" id="name" class="form-control">
                            </div>

                            <div class="mb-2">
                                <label class="form-label primary-text">Email *</label>
                                <input type="email" id="email" class="form-control">
                            </div>

                            <div class="mb-2">
                                <label class="form-label primary-text">Phone *</label>
                                <input type="tel" id="phone" class="form-control" maxlength="10"
                                    oninput="this.value=this.value.replace(/[^0-9]/g,'')">
                            </div>

                            <div class="mb-3">
                                <label class="form-label primary-text">How did you find us? *</label>
                                <select id="source" class="form-select">
                                    <option value="">Select option</option>
                                    <option value="google">Google</option>
                                    <option value="facebook">Facebook</option>
                                    <option value="friend">Friend</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>

                            <button type="submit" id="submitBtn" class="btn w-100 text-white fw-semibold primary-bg">
                                <span id="btnText"><i class="fa-solid fa-paper-plane"></i> SEND</span>
                                <span id="btnLoader" class="d-none">
                                    <i class="fa-solid fa-spinner fa-spin"></i> Sending...
                                </span>
                            </button>

                            <p id="successMsg" class="text-success text-center mt-3 small d-none"></p>
                            <p id="errorMsg" class="text-danger text-center mt-3 small d-none"></p>

                        </form>
                    </div>
                </div>

                <!-- IMAGE -->
                <div
                    class="col-md-4 d-none d-md-flex align-items-center justify-content-center primary-bg position-relative">
                    <div style="position:absolute;left:-180px;">
                        <div style="width:350px;height:350px;border-radius:50%;
background:url('/files/contact-view.jpg') center/cover;"></div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- LOCATIONS -->
    <div class="row mt-3" id="locations"></div>

    <!-- TIMINGS -->
    <div class="card text-center shadow mt-3 mx-auto rounded-4" style="max-width:420px;">
        <div class="card-body">
            <h5 class="fw-bold primary-text"><i class="fa-solid fa-clock"></i> Office Timings</h5>
            <p class="mb-1">Mon – Fri: 9:30 AM – 6:00 PM</p>
            <p class="mb-0">Sat: 9:30 AM – 4:00 PM</p>
        </div>
    </div>

</div>

<script>
    /* FETCH LOCATIONS */
    fetch("/api/method/q_dynamics_ecommerce.api.testcenter_address.get_test_centers")
        .then(res => res.json())
        .then(data => {
            const container = document.getElementById("locations");
            (data.message || []).forEach(c => {
                container.insertAdjacentHTML("beforeend", `
<div class="col-md-4 mb-4">
<div class="card h-100 shadow-sm rounded-4 p-3">
<h6 class="fw-semibold primary-text">
<i class="fa-solid fa-location-dot"></i> ${c.test_center_name || ""}
</h6>
<p class="small">${c.address_line || ""}, ${c.city || ""} - ${c.pincode || ""}</p>
<p class="small"><i class="fa-solid fa-envelope"></i> ${c.email_id || ""}</p>
<div class="d-flex gap-2 mt-2">
<a href="tel:${c.contact_number}" class="btn btn-sm text-white w-50 primary-bg">Call</a>
<a href="${c.map_embed_link}" target="_blank" class="btn btn-sm btn-outline-secondary w-50">Map</a>
</div>
</div>
</div>`);
            });
        });

    /* FORM SUBMIT WITH LOADER */
    document.getElementById("contactForm").addEventListener("submit", function (e) {
        e.preventDefault();

        const name = document.getElementById("name").value.trim();
        const email = document.getElementById("email").value.trim();
        const phone = document.getElementById("phone").value.trim();
        const source = document.getElementById("source").value;

        const btn = document.getElementById("submitBtn");
        const btnText = document.getElementById("btnText");
        const btnLoader = document.getElementById("btnLoader");

        const successMsg = document.getElementById("successMsg");
        const errorMsg = document.getElementById("errorMsg");

        successMsg.classList.add("d-none");
        errorMsg.classList.add("d-none");

        if (!name || !email || !phone || !source) {
            errorMsg.textContent = "Please fill all fields.";
            errorMsg.classList.remove("d-none");
            return;
        }

        if (phone.length !== 10) {
            errorMsg.textContent = "Phone number must be 10 digits.";
            errorMsg.classList.remove("d-none");
            return;
        }

        /* SHOW LOADER */
        btn.disabled = true;
        btnText.classList.add("d-none");
        btnLoader.classList.remove("d-none");

        fetch("/api/method/q_dynamics_ecommerce.api.contact.submit_contact", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, email, phone, source })
        })
            .then(res => res.json())
            .then(() => {
                successMsg.textContent = "Message submitted successfully!";
                successMsg.classList.remove("d-none");
                document.getElementById("contactForm").reset();
            })
            .catch(() => {
                errorMsg.textContent = "Server error.";
                errorMsg.classList.remove("d-none");
            })
            .finally(() => {
                btn.disabled = false;
                btnText.classList.remove("d-none");
                btnLoader.classList.add("d-none");
            });
    });
</script>

{% endblock %}